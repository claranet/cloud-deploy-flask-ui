{% extends "base.html" %}

{% set page_title = 'Applications List' %}

{% block page_header %}
    <caption>Applications are sorted by last modification date</caption>
{% endblock %}"

{% block page_content %}
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Name / ID</th>
                <th>Created</th>
                <th>Modified</th>
                <th>Environment</th>
                <th>Role</th>
                <th>AWS Region</th>
                <th>AWS Instance Type</th>
                <th>AWS VPC</th>
                <th>Features</th>
                <th>Modules</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for app in apps | sort(reverse=True, attribute='_updated') %}
            <tr>
                <th scope="row">{{ loop.index }}</th>
                <td style="white-space:nowrap;">
                    <a href="/web/apps/{{ app['_id'] }}">{{ app['name'] }}</a>
                    <br>
                    {{ app['_id'] }}
                </td>
                <td style="white-space:nowrap;">{{ app['_created'] }}</td>
                <td style="white-space:nowrap;">{{ app['_updated'] }}</td>
                <td>{{ app['env'] }}</td>
                <td>{{ app['role'] }}</td>
                <td style="white-space:nowrap;">{{ app['region'] }}</td>
                <td style="white-space:nowrap;">{{ app['instance_type'] }}</td>
                <td style="white-space:nowrap;">{{ app['vpc_id'] }}</td>
                <td style="white-space:nowrap;">
                    {%- if app['features'] | length > 0 -%}
                        <abbr title="{{ app['features'] | map(attribute='name') | join(', ') }}">
                            {{- app['features'] | map(attribute='name') | join(', ') | truncate(5, True) -}}
                        </abbr>
                    {%- endif %}
                </td>
                <td style="white-space:nowrap;">
                    {%- if app['modules'] | length > 0 -%}
                        <abbr title="{{ app['modules'] | map(attribute='name') | join(', ') }}">
                            {{- app['modules'] | map(attribute='name') | join(', ') | truncate(5, True) -}}
                        </abbr>
                    {%- endif %}
                </td>
                <td style="white-space:nowrap;">
                    <a href="/web/apps/{{ app['_id'] }}/command"><button class="btn btn-default">Run Command</button></a>
                    <a href="/web/apps/{{ app['_id'] }}/edit"><button class="btn btn-default">Edit</button></a>
                    <a href="/web/apps/create?clone_from={{ app['_id'] }}"><button class="btn btn-default">Clone</button></a>
                    <a href="/web/apps/{{ app['_id'] }}/delete"><button class="btn btn-default">Delete</button></a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
