{% extends "base.html" %}
{% from "macros.html" import ghost_menulist with context %}
{% from "macros.html" import ghost_fieldlist with context %}
{% from "macros.html" import ghost_fieldlist_features with context %}

{% if edit %}
    {% set app = webhook['app_id'] or {'_id': '', 'name': '-', 'env': '-'} %}
{% endif %}
{% set page_title = edit and ('Edit webhook on app %s (%s/%s) - module %s %s' % (app['name'], app['env'], app['role'], webhook['module'], app_color)) or 'Create a Webhook' %}
{% set page_title_class = 'to-left' %}

{% block page_header %}
    {% if webhook_id %}
    <ul class="nav nav-stacked action-btns to-right">
        <li class="app-actions">
            <a href="/web/webhooks/create?clone_from={{ webhook_id }}"><button class="btn btn-raised btn-info"><span class="glyphicon glyphicon-duplicate"></span> Clone</button></a>
        </li>
        <li class="app-actions">
            <a href="/web/webhooks/{{ webhook_id }}/delete"><button class="btn btn-raised btn-danger"><span class="glyphicon glyphicon-trash"></span> Delete</button></a>
        </li>
    </ul>
    {% endif %}
{% endblock %}

{% block page_content %}
    <form class="form-horizontal app-panel" id="webhook-form" method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <a name="properties" class="anchor">&nbsp;</a>
        <div class="panel panel-default">
            <div class="panel-heading">
                <strong>Webhook properties</strong>
            </div>
            <div class="panel-body">
                <div class="row">
                    {{ wtf.form_field(form.app_id_ro if edit else form.app_id, form_type='horizontal', readonly=edit, placeholder='Application Name') }}
                    {{ wtf.form_field(form.module_ro if edit else form.module, readonly=edit, form_type='horizontal', placeholder='Module Name') }}
                    {{ wtf.form_field(form.rev, form_type='horizontal', placeholder='Revision Regex (ex: test*)') }}
                    {{ wtf.form_field(form.secret_token, form_type='horizontal', placeholder='Webhook Secret Token') }}
                    <div class="col-lg-offset-2">
                        {{ ghost_fieldlist(form.events, 'events', 'Events', 'events', 'Event', 'inline') }}
                    </div>
                    {{ wtf.form_field(form.commands, form_type='horizontal', placeholder='Commands to run') }}
                    <div class="deployment-params" style="{{ 'display:none;' if not form.commands.data == 'deploy' }}">
                        {{ wtf.form_field(form.deployment_strategy, form_type='horizontal', placeholder='Application Name') }}
                        {{ wtf.form_field(form.safe_deployment_strategy, form_type='horizontal', placeholder='Safe Deployment Strategy') }}
                    </div>
                    <div class="buildimage-params" style="{{ 'display:none;' if not form.commands.data == 'buildimage' }}">
                        {{ wtf.form_field(form.instance_type, form_type='horizontal') }}
                    </div>

                </div>
            </div>
        </div>

        {{ wtf.form_field(form.submit) }}
    </form>
{% endblock %}

{% block page_scripts %}
    <script src="{{url_for('.static', filename='scripts/app-command.js')}}?v={{current_revision}}"></script>
    <script src="{{url_for('.static', filename='scripts/app-infos.js')}}?v={{current_revision}}"></script>
    <script src="{{url_for('.static', filename='scripts/webhook-edit.js')}}?v={{current_revision}}"></script>
{% endblock %}
