{% extends "base.html" %}

{% set page_title = 'Jobs' %}

{% block page_header %}
    <caption>Sorted by creation date</caption>
{% endblock %}"

{% block page_content %}
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>ID&nbsp;/ Technical ID</th>
                <th>Created / Modified</th>
                <th>Application</th>
                <th>Command</th>
                <th>Status</th>
                <th>User</th>
                <th>Options</th>
                <th>Modules</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs | sort(reverse=True, attribute='_created') %}
            <tr>
                <th scope="row">{{ loop.index }}</th>
                <td style="white-space:nowrap;">
                    <a href="/web/jobs/{{ job['_id'] }}">{{ job['job_id'] or '-' }}
                    <br>
                    <a href="/web/jobs/{{ job['_id'] }}">{{ job['_id'] }}</a>
                </td>
                <td style="white-space:nowrap;">
                    {{ job['_created'] }}
                    <br>
                    {{ job['_updated'] }}</td>
                <td style="white-space:nowrap;">
                    <a href="/web/apps/{{ job['app_id'] }}">{{ job['app_name'] }} ({{ job['app_env'] }})</a>
                </td>
                <td style="white-space:nowrap;">{{ job['command'] }}</td>
                <td style="white-space:nowrap;">{{ job['status'] }}</td>
                <td style="white-space:nowrap;">{{ job['user'] }}</td>
                <td style="white-space:nowrap;">
                    {% for option in job['options'] %}
                        {{ option }}<br>
                    {% endfor %}
                </td>
                <td style="white-space:nowrap;">
                    {% for module in job['modules'] %}
                        {{ module['name'] }}:{{ module['rev'] }}<br>
                    {% endfor %}
                </td>
                <td style="white-space:nowrap;">
                    <a href="/web/jobs/{{ job['_id'] }}/delete"><button class="btn btn-default" {%- if job['status'] not in ['done', 'failed'] -%}disabled{%-endif-%}>Delete</button></a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
