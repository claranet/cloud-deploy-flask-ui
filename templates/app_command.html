{% extends "base.html" %}

{% set page_title = 'Run Command on %s (%s)' % (app['name'], app['env']) %}

{% block page_content %}
    <form class="form-horizontal" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label class="control-label col-lg-2 required">Application</label><div class="col-lg-10"><div class="form-control">{{ app['name'] }}</div></div>
        </div>
        <div class="form-group">
            <label class="control-label col-lg-2">Environment</label><div class="col-lg-10"><div class="form-control">{{ app['env'] }}</div></div>
        </div>
        {{ form.hidden_tag() }}

        {{ wtf.form_field(form.command, form_type='horizontal') }}

        <div class="command_options">
            <div class="wrap module_name">{{ wtf.form_field(form.module_name, form_type='horizontal') }}</div>
            <div class="wrap module_rev">{{ wtf.form_field(form.module_rev, form_type='horizontal') }}</div>
            <div class="wrap deploy_id">{{ wtf.form_field(form.deploy_id, form_type='horizontal') }}</div>
            <div class="wrap fabric_execution_strategy">{{ wtf.form_field(form.fabric_execution_strategy, form_type='horizontal') }}</div>
            <div class="wrap instance_type">{{ wtf.form_field(form.instance_type, form_type='horizontal') }}</div>
            <div class="wrap skip_salt_bootstrap">{{ wtf.form_field(form.skip_salt_bootstrap, form_type='horizontal') }}</div>
        </div>
        {{ wtf.form_field(form.submit, form_type='horizontal') }}
    </form>
{% endblock %}

{% block page_scripts %}
    <script type="text/javascript">
    (function() {
        function show_options_fields()  {
            $('.wrap').hide();
            if ($('#command').val() == 'deploy') {
                $('.wrap.module_name').show();
                $('.wrap.module_rev').show();
                $('.wrap.fabric_execution_strategy').show();
            } else if ($('#command').val() == 'redeploy') {
                $('.wrap.deploy_id').show();
                $('.wrap.fabric_execution_strategy').show();
            } else if ($('#command').val() == 'buildimage') {
                $('.wrap.instance_type').show();
                $('.wrap.skip_salt_bootstrap').show();
            }
        }

        show_options_fields();
        $('#command').change(function() {
            show_options_fields();
        });

        $('#command option').each(function() {
            cmd = $(this).val();
            desc = $(this).text();
            $(this).text(cmd);
            $(this).attr('data-subtext', ' - ' + desc);
        });
        $('#command').selectpicker('refresh');
    })();
    </script>
{% endblock %}
