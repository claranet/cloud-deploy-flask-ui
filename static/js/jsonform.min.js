// JSONForm https://github.com/ulion/jsonform/commits/dev bf414ee62fbb02ee8b87b71727bdbb0917d647f6
!function(e,t,n,i,a){e&&!i&&(i=require("underscore"));var l=function(e){return e?{groupClass:"control-group",groupMarkClassPrefix:"",labelClass:"control-label",controlClass:"controls",iconClassPrefix:"icon",buttonClass:"btn",textualInputClass:"",prependClass:"input-prepend",appendClass:"input-append",addonClass:"add-on",inlineClassSuffix:" inline"}:{groupClass:"form-group",groupMarkClassPrefix:"has-",labelClass:"control-label",controlClass:"controls",iconClassPrefix:"glyphicon glyphicon",buttonClass:"btn btn-default",textualInputClass:"form-control",prependClass:"input-group",appendClass:"input-group",addonClass:"input-group-addon",buttonAddonClass:"input-group-btn",inlineClassSuffix:"-inline"}},s=/\[([0-9]*)\](?=\[|\.|$)/g,r={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},o={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},d="string"==typeof i.template("",{})?i.template:function(e,t,n){return i.template(e,n)(t)},m=function(e){return!(i.isUndefined(e)||i.isNull(e))},c=function(e,t){return"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,t)},u={util:{}},h=function(e){return m(e)?(e=""+e,e?e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""):""},f=function(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},p=function(e){var t=function(e,t){t.find("> .active").removeClass("active"),e.addClass("active")},i=function(e,t){e.find("input, textarea, select").removeAttr("disabled"),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")},a=function(e){var a,l=n("option:selected",n(this)),s=n(this),r=l.get(0).getAttribute("data-idx")||l.attr("value");e.preventDefault(),l.hasClass("active")||(a=n(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+r+"]"),t(l,s),t(a,a.parent()),i(a,r))},l=function(e){n("a",n(this));var a=n(this).parents(".tabbable").first().find(".tab-content").first(),l=n(this).index(),s=a.find("> [data-idx="+l+"]");e.preventDefault(),t(n(this),n(this).parent()),t(s,s.parent()),n(this).parent().hasClass("jsonform-alternative")&&i(s,l)};e.each(function(){n(this).delegate("select.nav","change",a),n(this).find("select.nav").each(function(){n(this).val(n(this).find(".active").attr("value"));var e=n(this).find("option:selected").get(0).getAttribute("data-idx")||n(this).find("option:selected").attr("value"),t=n(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");i(t,e)}),n(this).delegate("ul.nav li","click",l),n(this).find("ul.nav li.active").click()})};u.fieldTemplate=function(e){return'<div class="<%= cls.groupClass %> jsonform-node jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.required && node.formElement && (node.formElement.type !== "checkbox") ? " jsonform-required" : "") %><%= (node.isReadOnly() ? " jsonform-readonly" : "") %><%= (node.disabled ? " jsonform-disabled" : "") %>" data-jsonform-type="<%= node.formElement.type %>"><% if (node.title && !elt.notitle && elt.inlinetitle !== true) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.title %></label><% } %><div class="<%= cls.controlClass %>"><% if (node.description) { %><span class="help-block jsonform-description"><%= node.description %></span><% } %><% if (node.prepend || node.append) { %><div class="<%= node.prepend ? cls.prependClass : "" %> <%= node.append ? cls.appendClass : "" %>"><% if (node.prepend && node.prepend.indexOf("<button ") >= 0) { %><% if (cls.buttonAddonClass) { %><span class="<%= cls.buttonAddonClass %>"><%= node.prepend %></span><% } else { %><%= node.prepend %><% } %><% } %><% if (node.prepend && node.prepend.indexOf("<button ") < 0) { %><span class="<%= cls.addonClass %>"><%= node.prepend %></span><% } %><% } %>'+e+'<% if (node.append && node.append.indexOf("<button ") >= 0) { %><% if (cls.buttonAddonClass) { %><span class="<%= cls.buttonAddonClass %>"><%= node.append %></span><% } else { %><%= node.append %><% } %><% } %><% if (node.append && node.append.indexOf("<button ") < 0) { %><span class="<%= cls.addonClass %>"><%= node.append %></span><% } %><% if (node.prepend || node.append) { %></div><% } %><span class="help-block jsonform-errortext" style="display:none;"></span></div></div>'};var v='<div class="_jsonform-preview"><% if (value.type=="image") { %><img class="jsonform-preview" id="jsonformpreview-<%= id %>" src="<%= value.url %>" /><% } else { %><a href="<%= value.url %>"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)<% } %></div><a href="#" class="<%= cls.buttonClass %> _jsonform-delete"><i class="<%= cls.iconClassPrefix %>-remove" title="Remove"></i></a> ',g=function(e,t,a){var l={template:'<input type="'+e+'" class="<%= fieldHtmlClass'+(t?" || cls.textualInputClass":"")+' %>" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement&&t.formElement.autocomplete&&(i=n(t.el).find("input")).autocomplete&&i.autocomplete(t.formElement.autocomplete),t.formElement&&(t.formElement.tagsinput||"tagsvalue"===t.formElement.getValue)){if(!n.fn.tagsinput)throw new Error("tagsinput is not found");var i=n(t.el).find("input"),a=Array.isArray(t.value);a&&i.attr("value","").val(""),i.tagsinput(t.formElement?t.formElement.tagsinput||{}:{}),a&&t.value.forEach(function(e){i.tagsinput("add",e)})}if(t.formElement&&t.formElement.typeahead&&(i=n(t.el).find("input")).typeahead)if(Array.isArray(t.formElement.typeahead)){for(var l=1;l<t.formElement.typeahead.length;++l){var s=t.formElement.typeahead[l];if(s.source&&Array.isArray(s.source)){var r=s.source;s.source=function(e,t){var n=e.toLowerCase();t(r.filter(function(e){return e.toLowerCase().indexOf(n)>=0}).map(function(e){return"string"==typeof e?{value:e}:e}))}}}n.fn.typeahead.apply(i,t.formElement.typeahead)}else i.typeahead(t.formElement.typeahead)}};return a&&(l=i.extend(l,a)),l},y=function(e,t){return{template:'<input type="'+e+'" class="<%= fieldHtmlClass'+(t?" || cls.textualInputClass":"")+' %>" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (range.min !== undefined ? " min="+range.min : "")%><%= (range.max !== undefined ? " max="+range.max : "")%><%= (range.step !== undefined ? " step="+range.step : "")%><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(t,n){if(t.range={step:1},"range"==e&&(t.range.min=1,t.range.max=100),n&&n.schemaElement){n.formElement&&n.formElement.step?t.range.step=n.formElement.step:"number"==n.schemaElement.type&&(t.range.step="any");var i="any"===t.range.step?1:t.range.step;void 0!==n.schemaElement.minimum&&(n.schemaElement.exclusiveMinimum?t.range.min=n.schemaElement.minimum+i:t.range.min=n.schemaElement.minimum),void 0!==n.schemaElement.maximum&&(n.schemaElement.exclusiveMaximum?t.range.max=n.schemaElement.maximum-i:t.range.max=n.schemaElement.maximum)}}}};u.elementTypes={none:{template:""},root:{template:"<div><%= children %></div>"},text:g("text",!0),password:g("password",!0),date:g("date",!0,{onInsert:function(e,t){if(window.Modernizr&&window.Modernizr.inputtypes&&!window.Modernizr.inputtypes.date){var a=n(t.el).find("input");if(a.datepicker){var l={dateFormat:"yy-mm-dd"};t.formElement&&t.formElement.datepicker&&"object"==typeof t.formElement.datepicker&&i.extend(l,t.formElement.datepicker),a.datepicker(l)}}}}),datetime:g("datetime",!0),"datetime-local":g("datetime-local",!0,{onBeforeRender:function(e,t){e.value&&e.value.getTime&&(e.value=new Date(e.value.getTime()-6e4*e.value.getTimezoneOffset()).toISOString().slice(0,-1))}}),email:g("email",!0),month:g("month",!0),number:y("number",!0),search:g("search",!0),tel:g("tel",!0),time:g("time",!0),url:g("url",!0),week:g("week",!0),range:y("range"),color:{template:'<input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){n(t.el).find("#"+f(t.id)).spectrum({preferredFormat:"hex",showInput:!0})}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" style="<%= elt.height ? "height:" + elt.height + ";" : "" %>width:<%= elt.width || "100%" %>;"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var i=function(){n(t.el).data("wysihtml5")||(n(t.el).data("wysihtml5_loaded",!0),n(t.el).find("#"+f(t.id)).wysihtml5({html:!0,link:!0,"font-styles":!0,image:!0,events:{load:function(){n(this.textareaElement).removeAttr("required")}}}))};if(window.jsonform_wysihtml5_setup)window.jsonform_wysihtml5_setup(i);else var a=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(a),i())},1e3)}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){(e.value&&"object"==typeof e.value||Array.isArray(e.value))&&(e.value=a.stringify(e.value,null,2))},onInsert:function(e,t){var l=function(){var e=t.formElement||{},l=window.ace.edit(n(t.el).find("#"+f(t.id)+"__ace").get(0)),s="#"+f(t.id)+"__hidden";l.getSession().setNewLineMode("unix"),l.renderer.setShowPrintMargin(!1),l.setTheme("ace/theme/"+(e.aceTheme||"twilight")),e.aceMode&&l.getSession().setMode("ace/mode/"+e.aceMode),l.getSession().setTabSize(2);var r=t.value;null===r||void 0===r?r="":("object"==typeof r||Array.isArray(r))&&(r=a.stringify(r,null,2)),l.getSession().setValue(r);var o=i.debounce(function(){n(t.el).find(s).val(l.getSession().getValue()),n(t.el).find(s).change()},600);l.getSession().on("change",o),l.on("blur",function(){n(t.el).find(s).change(),n(t.el).find(s).trigger("blur")}),l.on("focus",function(){n(t.el).find(s).trigger("focus")})};if(window.jsonform_ace_setup)window.jsonform_ace_setup(l);else var s=window.setInterval(function(){window.ace&&(window.clearInterval(s),l())},1e3)}},checkbox:{template:'<div class="checkbox"><label><input type="checkbox" id="<%= id %>" name="<%= node.name %>" value="1" <% if (value) {%>checked<% } %><%= (node.disabled? " disabled" : "")%><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %> /><span><%= (node.inlinetitle === true ? node.title : node.inlinetitle) || "" %></span></label></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement.toggleNext){var i=!0===t.formElement.toggleNext?1:t.formElement.toggleNext,a="jsonform-toggle-next jsonform-toggle-next-"+i,l=1===i?n(t.el).next():"all"===i?n(t.el).nextAll():n(t.el).nextAll().slice(0,i);l.addClass("jsonform-toggle-next-target"),n(t.el).addClass(a).find(":checkbox").on("change",function(){var e=n(this).is(":checked");n(t.el).toggleClass("checked",e),l.toggle(e).toggleClass("jsonform-toggled-visible",e)}).change()}},getElement:function(e){return n(e).parent().parent().get(0)}},file:{template:'<input class="input-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.required ? " required=\'required\'" : "") %>/>',fieldtemplate:!0,inputfield:!0},"file-hosted-public":{template:"<span><% if (value && (value.type||value.url)) { %>"+v+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="<%= transloaditname %>" /><input data-transloadit-name="_transloadit_<%= transloaditname %>" type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)},onBeforeRender:function(e,t){t.ownerTree._transloadit_generic_public_index?t.ownerTree._transloadit_generic_public_index++:t.ownerTree._transloadit_generic_public_index=1,e.transloaditname="_transloadit_jsonform_genericupload_public_"+t.ownerTree._transloadit_generic_public_index,t.ownerTree._transloadit_generic_elts||(t.ownerTree._transloadit_generic_elts={}),t.ownerTree._transloadit_generic_elts[e.transloaditname]=t},onChange:function(e,t){if(t.ownerTree._transloadit_bound)return!1;t.ownerTree._transloadit_bound=!0;var l=n(t.ownerTree.domRoot);l.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(e){var n=i.values(e.results);n=i.flatten(n),i.each(n,function(e){var n=t.ownerTree._transloadit_generic_elts[e.field].id,s=l.find("#"+f(n)),r=i.filter(i.keys(e.meta),function(t){return!!m(e.meta[t])});e.meta=i.pick(e.meta,r),s.val(a.stringify(e))}),t.ownerTree._transloadit_bound=!1,l.unbind("submit.transloadit"),i.delay(function(){console.log("submit form"),t.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,t){n(t.el).find("a._jsonform-delete").on("click",function(e){return n(t.el).find("._jsonform-preview").remove(),n(t.el).find("a._jsonform-delete").remove(),n(t.el).find("#"+f(t.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},"file-transloadit":{template:"<span><% if (value && (value.type||value.url)) { %>"+v+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="_transloadit_<%= node.name %>" /><input type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)},onChange:function(e,t){if(t.ownerTree._transloadit_bound)return!1;t.ownerTree._transloadit_bound=!0;var l=n(t.ownerTree.domRoot);l.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(e){var n=i.values(e.results);n=i.flatten(n),i.each(n,function(e){var t=l.find('input[name="'+e.field.replace(/^_transloadit_/,"")+'"]'),n=i.filter(i.keys(e.meta),function(t){return!!m(e.meta[t])});e.meta=i.pick(e.meta,n),t.val(a.stringify(e))}),t.ownerTree._transloadit_bound=!1,l.unbind("submit.transloadit"),i.delay(function(){console.log("submit form"),t.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,t){n(t.el).find("a._jsonform-delete").on("click",function(e){return n(t.el).find("._jsonform-preview").remove(),n(t.el).find("a._jsonform-delete").remove(),n(t.el).find("#"+f(t.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},select:{template:'<select name="<%= node.name %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>"<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select>',fieldtemplate:!0,inputfield:!0},tagsinput:{template:'<select name="<%= node.name %><%= node.formElement.getValue === "tagsinput" ? "" : "[]" %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" multiple<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> </select>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(!n.fn.tagsinput)throw new Error("tagsinput is not found");var i=n(t.el).find("select");i.tagsinput(t.formElement?t.formElement.tagsinput||{}:{}),t.value&&t.value.forEach(function(e){i.tagsinput("add",e)})}},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="<%= node.value ? buttonClass : cls.buttonClass %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="<%= buttonClass %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="<%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=null,a=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.prefix=n.imagePrefix||"",e.suffix=n.imageSuffix||"",e.width=n.imageWidth||32,e.height=n.imageHeight||32,e.buttonClass=n.imageButtonClass||e.cls.buttonClass,t.options.length>a?(i=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/i)):e.columns=a},getElement:function(e){return n(e).parent().get(0)},onInsert:function(e,t){n(t.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var i=("img"===e.target.nodeName.toLowerCase()?n(e.target):n(e.target).find("img")).attr("src"),a=t.formElement||{},l=a.imagePrefix||"",s=a.imageSuffix||"",r=a.imageWidth||32,o=a.imageHeight||32;i?(0===i.indexOf(l)&&(i=i.substring(l.length)),i=i.substring(0,i.length-s.length),n(t.el).find("input").attr("value",i),n(t.el).find('a[data-toggle="dropdown"]').addClass(a.imageButtonClass).attr("style","max-width:"+r+"px;max-height:"+o+"px").html('<img src="'+(i.match(/^https?:/)?"":l)+i+s+'" alt="" />')):(n(t.el).find("input").attr("value",""),n(t.el).find('a[data-toggle="dropdown"]').removeClass(a.imageButtonClass).removeAttr("style").html(a.imageSelectorTitle||"Select..."))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="<%= node.value ? buttonClass : cls.buttonClass %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><i class="<%= cls.iconClassPrefix %>-<%= node.value %>" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="<%= buttonClass %>" ><% if (key instanceof Object) { %><i class="<%= cls.iconClassPrefix %>-<%= key.value %>" alt="<%= key.title %>" /></a><% } else { %><i class="<%= cls.iconClassPrefix %>-<%= key %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="<%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=null,a=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.buttonClass=n.imageButtonClass||e.cls.buttonClass,t.options.length>a?(i=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/i)):e.columns=a},getElement:function(e){return n(e).parent().get(0)},onInsert:function(e,t){n(t.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var i=("i"===e.target.nodeName.toLowerCase()?n(e.target):n(e.target).find("i")).attr("class"),a=t.formElement||{};i?(i=i,n(t.el).find("input").attr("value",i),n(t.el).find('a[data-toggle="dropdown"]').addClass(a.imageButtonClass).html('<i class="'+i+'" alt="" />')):(n(t.el).find("input").attr("value",""),n(t.el).find('a[data-toggle="dropdown"]').removeClass(a.imageButtonClass).html(a.imageSelectorTitle||"Select..."))})}},radios:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><% if (!elt.inline) { %><div class="radio"><label><% } else { %><label class="radio<%= cls.inlineClassSuffix %>"><% } %><input type="radio" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>"<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>/><span><%= (key instanceof Object ? key.title : key) %></span></label><%= elt.inline ? "" : "</div>" %> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement.toggleNextMap){var i={};for(var a in t.formElement.toggleNextMap){var l=t.formElement.toggleNextMap[a],s=!0===l?1:l,r="jsonform-toggle-next jsonform-toggle-next-"+s,o=1===s?n(t.el).next():"all"===s?n(t.el).nextAll():n(t.el).nextAll().slice(0,s);o.addClass("jsonform-toggle-next-target"),i[a]=o}n(t.el).addClass(r).find(":radio").on("change",function(){var e=n(this),t=e.val(),a=e.is(":checked");if(a)for(var l in i){var s=i[l];l===t?s.toggle(a).toggleClass("jsonform-toggled-visible",a):s.toggle(!a).toggleClass("jsonform-toggled-visible",!a)}else for(var l in i)(s=i[l]).toggle(!1).toggleClass("jsonform-toggled-visible",!1)}).change()}}},radiobuttons:{template:'<div id="<%= node.id %>"  class="<%= elt.htmlClass ? " " + elt.htmlClass : "" %>"><% _.each(node.options, function(key, val) { %><label class="<%= cls.buttonClass %>"><input type="radio" style="position:absolute;left:-9999px;" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" /><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var i="active",a=t.formElement||{};a.activeClass&&(i+=" "+a.activeClass),n(t.el).find("label").on("click",function(){n(this).parent().find("label").removeClass(i),n(this).addClass(i)}).find(":checked").closest("label").addClass(i)}},checkboxes:{template:'<div id="<%= node.id %>"><%= choiceshtml %><%= children %></div>',fieldtemplate:!0,inputfield:!0,childTemplate:function(e,t){if(!t.formElement.otherField)return e;var n="";t.formElement.otherField.asArrayValue&&t.otherValues&&(n+='<% value = node.parentNode.otherValues.join(", ") %>'),n+='<input type="checkbox"<%= value !== undefined && value !== null && value !== "" ? " checked=\'checked\'" : "" %>',(!t.formElement.otherField.asArrayValue&&!0!==t.formElement.otherField.novalue||!1===t.formElement.otherField.novalue)&&(n+=' name="'+t.key+"["+(void 0!==t.formElement.otherField.idx?t.formElement.otherField.idx:t.formElement.options.length)+']" value="'+(t.formElement.optionsAsEnumOrder?1:t.formElement.otherField.otherValue||"OTHER")+'"'),n+='<%= node.disabled? " disabled" : "" %> />',n+='<span><%= node.title || "Other" %> </span>';var i="other-field";return t.formElement.otherField.inline&&(n+='<div class="other-field-content">'+e+"</div>",i="inline-"+i),n=t.formElement.inline?'<label class="'+i+' checkbox<%= cls.inlineClassSuffix %>">'+n+"</label>":'<div class="'+i+' checkbox"><label>'+n+"</label></div>",t.formElement.otherField.inline||(n+='<div class="other-field-content">'+e+"</div>"),n},onBeforeRender:function(e,t){if(t&&t.schemaElement&&t.schemaElement.items){var n=t.formElement.options;if(n){var a='<input type="checkbox"<%= checked ? " checked=\'checked\'" : "" %> name="<%= name %>" value="<%= escape(value) %>"<%= node.disabled? " disabled" : "" %> /><span><%= title %></span>';a=t.formElement.inline?'<label class="checkbox'+e.cls.inlineClassSuffix+'">'+a+"</label>":'<div class="checkbox"><label>'+a+"</label></div>";var l="";if(t.formElement.otherField&&t.formElement.otherField.asArrayValue&&t.value){var s=n.map(function(e){return e.value}),o=[];t.value.forEach(function(e){i.include(s,e)||o.push(e)}),o.length>0&&(t.otherValues=o)}else delete t.otherValues;i.each(n,function(e,n){t.formElement.otherField&&e.value===(t.formElement.otherField.otherValue||"OTHER")?t.formElement.otherField.idx=n:l+=d(a,{name:t.key+"["+n+"]",value:t.formElement.optionsAsEnumOrder?1:e.value,checked:i.include(t.value,e.value),title:e.title,node:t,escape:h},r)}),t.formElement.otherField,e.choiceshtml=l}}},onInsert:function(e,t){function i(e){var t=!1;return e.each(function(){var e=n(this);if(e.is(":checkbox, :radio")&&e.prop("checked"))return t=!0,!1;if(!e.is("button"))return""!==n(this).val()?(t=!0,!1):void 0}),t}function a(){l.prop("checked",i(s))}var l=t.formElement.otherField&&t.formElement.otherField.inline?n(t.el).find(".inline-other-field :checkbox").first():n(t.el).find(".other-field :checkbox"),s=n(t.el).find(".other-field-content :input");s.on("keyup",a).on("change",a).change(),l.on("change",function(){this.checked?(this.checked=!1,s.not(":checkbox,:radio,button").focus()):s.filter("input[type=text], textarea").val("")})}},checkboxbuttons:{template:'<div id="<%= node.id %>"><%= choiceshtml %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=null,a=null,l='<label class="<%= cls.buttonClass %> '+e.fieldHtmlClass+'"><input type="checkbox" style="position:absolute;left:-9999px;" <% if (checked) { %> checked="checked" <% } %> name="<%= name %>" value="<%= value %>"<%= (node.disabled? " disabled" : "")%>/><span><%= title %></span></label>';t&&t.schemaElement&&t.schemaElement.items&&(n=t.formElement.options)&&(t.value&&Array.isArray(t.value)||(t.value=[]),a="",i.each(n,function(n,s){a+=d(l,{name:t.key+"["+s+"]",checked:i.include(t.value,n.value),value:n.value,title:n.title,node:t,cls:e.cls},r)}),e.choiceshtml=a)},onInsert:function(e,t){var i="active",a=t.formElement||{};a.activeClass&&(i+=" "+a.activeClass),n(t.el).find("label").on("click",function(){n(this).toggleClass(i,n(this).find("input:checkbox").prop("checked"))}).find(":checked").closest("label").addClass(i)}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><% if (!node.isReadOnly()) { %><span class="_jsonform-array-buttons"><a href="#" class="<%= cls.buttonClass %> _jsonform-array-addmore"><i class="<%= cls.iconClassPrefix %>-plus-sign" title="Add new"></i></a> <a href="#" class="<%= cls.buttonClass %> _jsonform-array-deletelast"><i class="<%= cls.iconClassPrefix %>-minus-sign" title="Delete last"></i></a></span><% } %></div>',fieldtemplate:!0,array:!0,childTemplate:function(e,t){return!t.isReadOnly()&&n("").sortable?'<li data-idx="<%= node.childPos %>"><span class="draggable line"><i class="<%= cls.iconClassPrefix %>-list" title="Move item"></i></span> <a href="#" class="_jsonform-array-item-delete"><i class="<%= cls.iconClassPrefix %>-remove" title="Remove item"></i></a>'+e+"</li>":'<li data-idx="<%= node.childPos %>">'+e+"</li>"},onInsert:function(e,t){var i=n(t.el).find("#"+f(t.id)),a=t.getArrayBoundaries(),l=function(e,a){if(e!==a){var l=e<a?1:-1,s=0,r=n("> ul",i);for(s=e;s!==a;s+=l)t.children[s].switchValuesWith(t.children[s+l]),t.children[s].render(r.get(0)),t.children[s+l].render(r.get(0));var o=n(t.children[e].el),d=n(t.children[a].el);o.detach(),d.detach(),e<a?(0===e?r.prepend(o):n(t.children[e-1].el).after(o),n(t.children[a-1].el).after(d)):(0===a?r.prepend(d):n(t.children[a-1].el).after(d),n(t.children[e-1].el).after(o))}},s=function(e){if(a.maxItems>=0){var l=a.maxItems-t.children.length;if(i.find("> span > a._jsonform-array-addmore").toggleClass("disabled",l<=1),l<1)return!1}t.insertArrayItem(e,n("> ul",i).get(0));var s=t.children.length>a.minItems;i.find("> span > a._jsonform-array-deletelast").toggleClass("disabled",!s),i.find("> ul > li > a._jsonform-array-item-delete").toggle(s)},r=function(e){var n=t.children.length-Math.max(a.minItems,0);if(i.find("> span > a._jsonform-array-deletelast").toggleClass("disabled",n<=1),i.find("> ul > li > a._jsonform-array-item-delete").toggle(n>1),n<1)return!1;t.deleteArrayItem(e),i.find("> span > a._jsonform-array-addmore").toggleClass("disabled",a.maxItems>=0&&t.children.length>=a.maxItems)};n("> span > a._jsonform-array-addmore",i).click(function(e){e.preventDefault(),e.stopPropagation();var n=t.children.length;s(n)});n("> ul > li",i).length;if(a.minItems>0)for(var o=t.children.length;o<a.minItems;o++)t.insertArrayItem(t.children.length,i.find("> ul").get(0));var d=t.children.length-Math.max(a.minItems,0);i.find("> span > a._jsonform-array-deletelast").toggleClass("disabled",d<=0),i.find("> ul > li > a._jsonform-array-item-delete").toggle(d>0),i.find("> span > a._jsonform-array-addmore").toggleClass("disabled",a.maxItems>=0&&t.children.length>=a.maxItems),n("> span > a._jsonform-array-deletelast",i).click(function(e){var n=t.children.length-1;e.preventDefault(),e.stopPropagation(),r(n)}),i.on("click","> ul > li > a._jsonform-array-item-delete",function(e){e.preventDefault();var i=n(e.currentTarget).parent();if(i.parent().parent().attr("id")==t.id){e.stopPropagation();var a=i.data("idx");r(a)}}),!t.isReadOnly()&&n(t.el).sortable&&(n("> ul",i).sortable(),n("> ul",i).bind("sortstop",function(e,t){var i=n(t.item).data("idx"),a=n(t.item).index();l(i,a)}))}},tabarray:{template:'<div id="<%= id %>"><div class="tabbable tabs-left"><ul class="nav nav-tabs"><%= tabs %></ul><div class="tab-content"><%= children %></div></div></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(e,t){e.tabs=""},onInsert:function(e,t){var a=n(t.el).find("#"+f(t.id)),l=t.getArrayBoundaries(),s=function(e,i){if(e!==i){var l=e<i?1:-1,s=0,r=n("> .tabbable > .tab-content",a).get(0);for(s=e;s!==i;s+=l)t.children[s].switchValuesWith(t.children[s+l]),t.children[s].render(r),t.children[s+l].render(r)}},r=function(e){var s="",r=!1;void 0===e&&((e=n("> .tabbable > .nav-tabs .active",a).data("idx"))?e=parseInt(e,10):(r=!0,e=0)),e>=t.children.length&&(e=t.children.length-1),i.each(t.children,function(e,n){var i=e.legend||e.title||"Item "+(n+1);s+='<li data-idx="'+n+'"><a class="draggable tab" data-toggle="tab">'+h(i),t.isReadOnly()||(s+=' <span href="#" class="_jsonform-array-item-delete"><i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-remove" title="Remove item"></i></span></a>'),s+="</li>"}),!t.isReadOnly()&&(l.maxItems<0||t.children.length<l.maxItems)&&(s+='<li data-idx="-1"><a class="tab _jsonform-array-addmore" title="'+(t.formElement.addMoreTooltip?h(t.formElement.addMoreTooltip):"Add new item")+'"><i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-plus-sign"></i> '+(t.formElement.addMoreTitle||"New")+"</a></li>"),n("> .tabbable > .nav-tabs",a).html(s);var o=l.minItems>=0&&t.children.length<=l.minItems;a.find("> .tabbable > .nav-tabs > li > a > ._jsonform-array-item-delete").toggle(!o),r&&n('> .tabbable > .nav-tabs [data-idx="0"]',a).addClass("active"),n('> .tabbable > .nav-tabs [data-toggle="tab"]',a).eq(e).click()},o=function(e){var n=t.children.length-Math.max(l.minItems,0);if(a.find("> a._jsonform-array-deleteitem").toggleClass("disabled",n<=1),a.find("> .tabbable > .nav-tabs > li > a > ._jsonform-array-item-delete").toggle(n>1),n<1)return!1;t.deleteArrayItem(e),r(),a.find("> a._jsonform-array-addmore").toggleClass("disabled",l.maxItems>=0&&t.children.length>=l.maxItems)},d=function(e){if(l.maxItems>=0){var n=l.maxItems-t.children.length;if(a.find("> a._jsonform-array-addmore").toggleClass("disabled",n<=1),n<1)return!1}t.insertArrayItem(e,a.find("> .tabbable > .tab-content").get(0)),r(e),a.find("> a._jsonform-array-deleteitem").toggleClass("disabled",t.children.length<=l.minItems)};if(n("> a._jsonform-array-deleteitem",a).click(function(e){var t=n("> .tabbable > .nav-tabs .active",a).data("idx");e.preventDefault(),e.stopPropagation(),o(t)}),a.on("click","> a._jsonform-array-addmore, > .tabbable > .nav-tabs > li > ._jsonform-array-addmore",function(e){var n=t.children.length;e.preventDefault(),e.stopPropagation(),d(n)}),a.on("click","> .tabbable > .nav-tabs > li > a > ._jsonform-array-item-delete",function(e){e.preventDefault(),e.stopPropagation();var t=n(e.currentTarget).closest("li").data("idx");o(t)}),n(t.el).on("legendUpdated",function(e){r(),e.preventDefault(),e.stopPropagation()}),!t.isReadOnly()&&n(t.el).sortable&&n("> .tabbable > .nav-tabs",a).sortable({containment:t.el,cancel:"._jsonform-array-addmore",tolerance:"pointer"}).on("sortchange",function(e,t){t.placeholder.index()==n(this).children().length-1&&-1==t.placeholder.prev().data("idx")&&t.placeholder.prev().before(t.placeholder)}).on("sortstop",function(e,t){var i=n(t.item).data("idx"),a=n(t.item).index();s(i,a),r(a)}),l.minItems>=0){for(var m=t.children.length;m<l.minItems;m++)d(t.children.length);r(0)}else r();a.find("> a._jsonform-array-addmore").toggleClass("disabled",l.maxItems>=0&&t.children.length>=l.maxItems);var c=l.minItems>=0&&t.children.length<=l.minItems;a.find("> a._jsonform-array-deleteitem").toggleClass("disabled",c),a.find("> .tabbable > .nav-tabs > li > a > ._jsonform-array-item-delete").toggle(!c)}},help:{template:'<span <%= id ? \'id="\' + id + \'"\' : "" %> class="help-block" style="padding-top:5px"><%= node.helpvalue || elt.helpvalue %></span>',fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},html:{template:"<%= elt.html %>"},textview:{template:'<pre id="<%= id %>" name="<%= node.name %>"><%= value %></pre>',inputfield:!0,fieldtemplate:!0},fieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="fieldset"><% if (node.title || node.legend) { %><legend><%= node.title || node.legend %></legend><% } %><% if (elt.expandable) { %><div hidden class="<%= cls.groupClass %>"><% } %><%= children %><% if (elt.expandable) { %></div><% } %><span class="help-block jsonform-errortext" style="display:none;"></span></fieldset>'},advancedfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable jsonform-node jsonform-error-<%= keydash %> <%= elt.htmlClass?elt.htmlClass:"" %>" data-jsonform-type="advancedfieldset"><legend>Advanced options</legend><div hidden class="<%= cls.groupClass %>"><%= children %></div><span class="help-block jsonform-errortext" style="display:none;"></span></fieldset>'},authfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable jsonform-node jsonform-error-<%= keydash %> <%= elt.htmlClass?elt.htmlClass:"" %>" data-jsonform-type="authfieldset"><legend>Authentication settings</legend><div hidden class="<%= cls.groupClass %>"><%= children %></div><span class="help-block jsonform-errortext" style="display:none;"></span></fieldset>'},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-primary <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:' <button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="<%= cls.buttonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button> '},actions:{template:'<div class="form-actions <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"><% if (node.legend) { %><legend><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="tabbable"><div class="<%= cls.groupClass %><%= node.formElement.hideMenu ? " hide" : "" %>"><% if (node.title && !elt.notitle) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.title %></label><% } %><div class="<%= cls.controlClass %>"><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return n(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(e,t){var n=null,a=[];t.schemaElement&&(a=t.schemaElement.enum||[]),n=t.options?i.map(t.options,function(e,n){var l=t.children[n];return e instanceof Object?(e=i.extend({node:l},e),e.title=e.title||l.legend||l.title||"Option "+(l.childPos+1),e.value=m(e.value)?e.value:m(a[n])?a[n]:n,e):{title:e,value:m(a[l.childPos])?a[l.childPos]:l.childPos,node:l}}):i.map(t.children,function(e,t){return{title:e.legend||e.title||"Option "+(e.childPos+1),value:a[e.childPos]||e.childPos,node:e}});var l=null;e.value&&(l=i.find(n,function(e){return e.value===t.value})),l||(l=i.find(n,function(e){return e.node.hasNonDefaultValue()})),l||(l=n[0]),l.node.active=!0,e.value=l.value;t.formElement;var s='<select class="nav '+e.cls.textualInputClass+'"'+(t.disabled?" disabled":"")+">";return i.each(n,function(e,t){s+='<option data-idx="'+t+'" value="'+e.value+'"'+(e.node.active?' class="active"':"")+">"+h(e.title)+"</option>"}),s+="</select>",e.tabs=s,e},onInsert:function(e,t){n(t.el).find("select.nav").first().on("change",function(e){var i=n(this).find("option:selected");n(t.el).find('input[type="hidden"]').first().val(i.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %> class="jsonform-node jsonform-error-<%= keydash %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)},onInsert:function(e,t){t.children&&0!==t.children.length&&(i.each(t.children,function(e){n(e.el).hide()}),n(t.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><% if (elt.optionsType === "radiobuttons") { %><label class="<%= cls.buttonClass%> <%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><% } else { %><% if (!elt.inline) { %><div class="radio"><% } %><label class="<%= elt.inline ? "radio"+cls.inlineClassSuffix : "" %> <%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><% } %><input type="radio" <% if (elt.optionsType === "radiobuttons") { %> style="position:absolute;left:-9999px;" <% } %>name="<%= node.id %>" value="<%= val %>"<%= (node.disabled? " disabled" : "")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label><%= elt.optionsType !== "radiobuttons" && !elt.inline ? "</div>" : "" %> <% }); %></div>',fieldtemplate:!0,onInsert:function(e,t){var a="active",l=t.formElement||{};l.activeClass&&(a+=" "+l.activeClass),n(t.el).find('input[type="radio"]').on("change",function(e){var l=null,s=t.options[n(this).val()];t.parentNode&&t.parentNode.el&&(n(t.el).find("label").removeClass(a),n(this).parent().addClass(a),n(t.el).nextAll().hide(),n(t.el).nextAll().find('input[type="radio"]').prop("checked",!1),s.value&&n(t.parentNode.el).find('input[type="hidden"]').val(s.value),s.next&&(l=i.find(t.parentNode.children,function(e){return e.formElement&&e.formElement.qid===s.next}),n(l.el).show(),n(l.el).nextAll().hide(),n(l.el).nextAll().find('input[type="radio"]').prop("checked",!1)),s.href&&(s.target?window.open(s.href,s.target):window.location=s.href),s.submit&&setTimeout(function(){t.ownerTree.submit()},0))})}}},u.util.getObjKey=function(e,t,n){for(var a=e,l=t.split("."),r=null,o=null,d=null,m=0;m<l.length;m++){if(null===a||"object"!=typeof a)return null;if(r=l[m],d=r.replace(s,""),s.lastIndex=0,o=s.exec(r))for(a=a[d];;){if(!i.isArray(a))return null;if(a=a[parseInt(o[1],10)],!(o=s.exec(r)))break}else a=n&&!a[d]&&i.isArray(a)&&a[0]?a[0][d]:a[d]}return n&&i.isArray(a)&&a[0]?a[0]:a},u.util.getObjKeyEx=function(e,t,n){var i=e;if(null===t||void 0===t||""===t)return e;if("string"==typeof n&&n.length>0){if(t.slice(0,n.length)!==n)throw console.log([n,e,t]),new Error("key ["+t+"] does not match the objKey ["+n+"]");"."===(t=t.slice(n.length))[0]&&(t=t.slice(1))}var a=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!a)throw new Error("bad format key: "+t);if("string"==typeof a[2]&&a[2].length>0)i=i[a[2]];else{if(!("string"==typeof a[4]&&a[4].length>0))throw new Error("impossible reach here");i=i[Number(a[4])]}return i&&a[5].length>0&&(i=this.getObjKeyEx(i,a[5])),i},u.util.setObjKey=function(e,t,n){for(var a=e,l=t.split("."),r=null,o=null,d=null,m=0;m<l.length-1;m++)if(r=l[m],d=r.replace(s,""),s.lastIndex=0,o=s.exec(r)){for(;;)if(i.isArray(a[d])||(a[d]=[]),a=a[d],d=parseInt(o[1],10),!(o=s.exec(r)))break;"object"==typeof a[d]&&null!==a[d]||(a[d]={}),a=a[d]}else"object"==typeof a[d]&&null!==a[d]||(a[d]={}),a=a[d];if(r=l[l.length-1],d=r.replace(s,""),s.lastIndex=0,o=s.exec(r)){for(;;)if(i.isArray(a[d])||(a[d]=[]),a=a[d],d=parseInt(o[1],10),!(o=s.exec(r)))break;a[d]=n}else a[d]=n};var b=function(e,t){var n=t.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),i=u.util.getObjKey(e,n,!0);if(i&&i.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return i},x=function(e,t,n){n=n||0;var i=void 0;if(m(t)&&""!==t)if(e.default&&0==n)i=u.util.getObjKeyEx(e.default,t);else{var a=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!a)throw new Error("bad format key: "+t);if("string"==typeof a[2]&&a[2].length>0)e=e.properties[a[2]];else{if(!("string"==typeof a[4]&&a[4].length>0))throw new Error("impossible reach here");e=e.items,n>0&&--n}e&&(i=e.default&&0==n?u.util.getObjKeyEx(e.default,a[5]):x(e,a[5],n))}else 0==n&&(i=e.default);return i},w=function(e,t,n){var i=0;return e?t&&0!==t.length?e.replace(s,function(e,a){var l=e;return n&&2!=l.length||!m(t[i])||(l="["+t[i]+"]"),i+=1,l}):e:null},C=function(e,t,n,a,l){var s=null;(a=a||{}).idx=a.idx||(n?n[n.length-1]:1),a.value=m(a.value)?a.value:"",a.getValue=a.getValue||function(t){return C(e,t,n,a,l)};var r=function(e,t){var n=null;return e&&e.length?(i.each(e,function(e){n||(e!==t?i.isString(e)||(e.key===t?n=e:e.items&&(n=r(e.items,t))):n={key:e})}),n):null},h=r(e.form||[],t),f=b(e.schema.properties,t);return l&&e.value&&(s=u.util.getObjKey(e.value,w(t,n))),m(s)||(h&&void 0!==h.value?s=h.value:f&&m(f.default)&&(s=f.default),s&&-1!==s.indexOf("{{values.")&&(s=s.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')),s&&(s=d(s,a,o))),m(s)&&h&&c(h.titleMap,s)&&(s=d(h.titleMap[s],a,o)),s&&i.isString(s)&&f&&f.maxLength&&s.length>f.maxLength&&(s=s.substr(0,f.maxLength-1)+"…"),m(s)?s:null},k=function(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0};k.prototype.clone=function(e){var t=new k;return t.childPos=this.childPos,t.arrayPath=i.clone(this.arrayPath),t.ownerTree=this.ownerTree,t.parentNode=e||this.parentNode,t.formElement=this.formElement,t.schemaElement=this.schemaElement,t.view=this.view,t.children=i.map(this.children,function(e){return e.clone(t)}),t},k.prototype.hasNonDefaultValue=function(){return(!this.formElement||"hidden"!=this.formElement.type)&&(!(!this.value||this.defaultValue)||!!i.find(this.children,function(e){return e.hasNonDefaultValue()}))},k.prototype.getProperty=function(e,t){var n=this[e];return void 0===n&&t&&this.parentNode?this.parentNode.getProperty(e,!0):n},k.prototype.isReadOnly=function(){return this.getProperty("readOnly",!0)},k.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},k.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return n(e.el).remove(),this.children.pop()},k.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},k.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),n=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(n,!0)},k.prototype.resetValues=function(){var e=null;if(this.value=null,this.parentNode?(this.arrayPath=i.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=n(":input",this.el).serializeArray(),i.each(e,function(e){n('[name="'+f(e.name)+'"]',n(this.el)).val("")},this);else if(this.view&&this.view.array)for(;this.children.length>0;)this.removeChild();i.each(this.children,function(e){e.resetValues()})},k.prototype.setChildTemplate=function(e){this.childTemplate=e,e.parentNode=this},k.prototype.getChildTemplate=function(){return this.childTemplate||this.view.array&&(this.formElement.items?key=this.formElement.items[0]||this.formElement.items:key=this.formElement.key+"[]",i.isString(key)&&(key={key:key}),this.setChildTemplate(this.ownerTree.buildFromLayout(key))),this.childTemplate},k.prototype.computeInitialValues=function(e,t,n){var a=this,l=null,s=1,r=0,c=this.ownerTree.formDesc.tpldata||{};if(n=n||0,this.parentNode?(this.arrayPath=i.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],c.idx=this.arrayPath.length>0?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,c.value="",c.getValue=function(t){return C(a.ownerTree.formDesc,t,a.arrayPath,c,!!e)},this.formElement&&(this.formElement.id?this.id=w(this.formElement.id,this.arrayPath):this.view&&this.view.array?this.id=f(this.ownerTree.formDesc.prefix)+"-elt-counter-"+i.uniqueId():this.parentNode&&this.parentNode.view&&this.parentNode.view.array?this.id=f(this.ownerTree.formDesc.prefix)+"-elt-counter-"+i.uniqueId():"button"!==this.formElement.type&&"selectfieldset"!==this.formElement.type&&"question"!==this.formElement.type&&"buttonquestion"!==this.formElement.type||(this.id=f(this.ownerTree.formDesc.prefix)+"-elt-counter-"+i.uniqueId()),this.formElement.key&&(this.key=w(this.formElement.key,this.arrayPath),this.keydash=this.key.replace(/\./g,"---")),this.name=w(this.formElement.name,this.arrayPath),i.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","required","placeholder","readOnly"],function(e){i.isString(this.formElement[e])?(-1!==this.formElement[e].indexOf("{{values.")?this[e]=this.formElement[e].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[e]=w(this.formElement[e],this.arrayPath),this[e]&&(this[e]=d(this[e],c,o))):this[e]=this.formElement[e]},this),this.formElement.options&&(this.options=i.map(this.formElement.options,function(e){var t=null;return i.isObject(e)&&e.title?(t=-1!==e.title.indexOf("{{values.")?e.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):w(e.title,a.arrayPath),i.extend({},e,{value:m(e.value)?e.value:"",title:d(t,c,o)})):e}))),this.view&&this.view.inputfield&&this.schemaElement){if(e)m(u.util.getObjKey(e,this.key))&&(this.value=u.util.getObjKey(e,this.key));else if(!t&&!m(this.value)){var h=x(a.ownerTree.formDesc.schema,this.key,n);m(h)&&(this.value=h,i.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=w(this.value,this.arrayPath,!0),this.value&&(this.value=d(this.value,c,o))),this.defaultValue=!0)}}else if(this.view&&this.view.array){s=1;var p=this.getArrayBoundaries().minItems;if(e){var v=u.util.getObjKeyEx(e,this.key);v&&Array.isArray(v)&&(s=v.length)}else t?p>=0&&(s=0):(h=x(a.ownerTree.formDesc.schema,this.key,n))&&Array.isArray(h)&&(s=h.length);for(r=0;r<s;r++)this.appendChild(this.getChildTemplate().clone())}if(i.each(this.children,function(i){i.computeInitialValues(e,t,n)}),this.formElement&&this.formElement.valueInLegend)for(l=this;l;){if(l.parentNode&&l.parentNode.view&&l.parentNode.view.array&&(l.legendChild=this,l.formElement&&l.formElement.legend)){l.legend=w(l.formElement.legend,l.arrayPath),c.idx=l.arrayPath.length>0?l.arrayPath[l.arrayPath.length-1]+1:l.childPos+1,c.value=m(this.value)?this.value:"",l.legend=d(l.legend,c,o);break}l=l.parentNode}},k.prototype.getFormValues=function(e){var t={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var l=n(":input",this.el).serializeArray();l=l.concat(n(":input[type=checkbox]:not(:disabled):not(:checked)[name]",this.el).map(function(){return{name:this.name,value:this.checked}}).get()),e&&i.each(l,function(t){t.name=w(t.name,e)});for(var s=this.ownerTree.formDesc.schema,r=0;r<l.length;r++){var o=l[r].name,d=b(s.properties,o),m=null,c=null;if(d)if(d._jsonform_checkboxes_as_array&&(m=o.match(/\[([0-9]*)\]$/)))o=o.replace(/\[([0-9]*)\]$/,""),c=u.util.getObjKey(t,o)||[],"value"===d._jsonform_checkboxes_as_array&&!1!==l[r].value&&""!==l[r].value?c.push(l[r].value):!0===d._jsonform_checkboxes_as_array&&"1"===l[r].value&&c.push(d.enum[parseInt(m[1],10)]),u.util.setObjKey(t,o,c);else if("tagsinput"!==d._jsonform_get_value_by_tagsinput)if("[]"!==o.slice(-2)||(o=o.slice(0,-2),"array"!==(d=b(s.properties,o)).type)){if("boolean"===d.type&&("0"===l[r].value||"false"===l[r].value?l[r].value=!1:""===l[r].value?l[r].value=null:l[r].value=!!l[r].value),"number"!==d.type&&"integer"!==d.type||i.isString(l[r].value)&&(l[r].value.length?isNaN(Number(l[r].value))||(l[r].value=Number(l[r].value)):l[r].value=null),"string"!==d.type||""!==l[r].value||d._jsonform_allowEmpty||(l[r].value=null),"object"===d.type&&i.isString(l[r].value)&&"{"===l[r].value.substring(0,1))try{l[r].value=a.parse(l[r].value)}catch(e){l[r].value={}}if("array"===d.type&&i.isString(l[r].value))if("["===l[r].value.substring(0,1))try{l[r].value=a.parse(l[r].value)}catch(e){l[r].value=[]}else l[r].value=null;"object"!==d.type||"null"!==l[r].value&&""!==l[r].value||(l[r].value=null),l[r].name&&null!==l[r].value&&u.util.setObjKey(t,l[r].name,l[r].value)}else(c=u.util.getObjKey(t,o)||[]).indexOf(l[r].value)<0&&(c.push(l[r].value),u.util.setObjKey(t,o,c));else{var h;if(e){var f=w(o,this.arrayPath);h=n(':input[name="'+f+'"]',this.el).tagsinput("items")}else h=n(':input[name="'+o+'"]',this.el).tagsinput("items");u.util.setObjKey(t,o,h)}}return t},k.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},k.prototype.setContent=function(e,t){var i=n(e),a=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot),l=null;this.el?n(this.el).replaceWith(i):(l=n(a).children().get(this.childPos))?n(l).before(i):n(a).append(i),this.el=i,this.updateElement(this.el)},k.prototype.updateElement=function(e){this.id&&(this.el=n("#"+f(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=n(this.el).parent().parent(),(this.prepend||this.append)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=n(this.el).parent().get(0))),i.each(this.children,function(t){t.updateElement(this.el||e)})},k.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:m(this.value)?this.value:"",cls:this.ownerTree.defaultClasses,escape:h},t=null;this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template?this.template:this.formElement&&this.formElement.template?this.formElement.template:this.view.template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=u.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t,this.parentNode));var n="";return i.each(this.children,function(e){n+=e.generate()}),e.children=n,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),d(t,e,r)},k.prototype.enhance=function(){function e(e){t.formElement&&t.formElement.legend&&t.parentNode&&(t.legend=w(t.formElement.legend,t.arrayPath),s.idx=t.arrayPath.length>0?t.arrayPath[t.arrayPath.length-1]+1:t.childPos+1,s.value=n(e.target).val(),t.legend=d(t.legend,s,o),n(t.parentNode.el).trigger("legendUpdated"))}var t=this,a=null,l=null,s=i.clone(this.ownerTree.formDesc.tpldata)||{};this.formElement&&(this.view.onInsert&&this.view.onInsert({target:n(this.el)},this),a=this.handlers||this.formElement.handlers,(l=this.onInsert||this.formElement.onInsert)&&l({target:n(this.el)},this),a&&i.each(a,function(e,t){"insert"===t&&e({target:n(this.el)},this)},this),this.el&&(this.onChange&&n(this.el).bind("change",function(e){t.onChange(e,t)}),this.view.onChange&&n(this.el).bind("change",function(e){t.view.onChange(e,t)}),this.formElement.onChange&&n(this.el).bind("change",function(e){t.formElement.onChange(e,t)}),this.onClick&&n(this.el).bind("click",function(e){t.onClick(e,t)}),this.view.onClick&&n(this.el).bind("click",function(e){t.view.onClick(e,t)}),this.formElement.onClick&&n(this.el).bind("click",function(e){t.formElement.onClick(e,t)}),this.onKeyUp&&n(this.el).bind("keyup",function(e){t.onKeyUp(e,t)}),this.view.onKeyUp&&n(this.el).bind("keyup",function(e){t.view.onKeyUp(e,t)}),this.formElement.onKeyUp&&n(this.el).bind("keyup",function(e){t.formElement.onKeyUp(e,t)}),a&&i.each(a,function(e,i){"insert"!==i&&n(this.el).bind(i,function(n){e(n,t)})},this)),this.formElement.legend&&this.legendChild&&this.legendChild.formElement&&(n(this.legendChild.el).on("keyup",e),n(this.legendChild.el).on("change",e))),i.each(this.children,function(e){e.enhance()})},k.prototype.insertArrayItem=function(e,t){var n=0;void 0===e&&(e=this.children.length);var i=this.getChildTemplate().clone();for(this.appendChild(i),i.resetValues(),n=this.children.length-2;n>=e;n--)this.children[n].moveValuesTo(this.children[n+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(null,!1,this.children[e].arrayPath.length),n=e;n<this.children.length;n++)this.children[n].render(t)},k.prototype.deleteArrayItem=function(e){var t=0;for(void 0===e&&(e=this.children.length-1),t=e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},k.prototype.getArrayBoundaries=function(){var e={minItems:-1,maxItems:-1};if(!this.view||!this.view.array)return e;var t=function(e,n){var a=null,l=null,s={minItems:-1,maxItems:-1};return n=n||e,e.view&&e.view.array&&e!==n?s:e.key?(l=e.key.replace(/\[[0-9]+\]/g,"[]"),e!==n&&(l=l.replace(/\[\][^\[\]]*$/,"")),(a=b(e.ownerTree.formDesc.schema.properties,l))?(a.minItems>=0&&(s.minItems=a.minItems),a.minLength>=0&&(s.minItems=a.minLength),a.maxItems>=0&&(s.maxItems=a.maxItems),a.maxLength>=0&&(s.maxItems=a.maxLength),s):s):(i.each(e.children,function(e){var i=t(e,n);-1!==i.minItems&&(-1!==s.minItems?s.minItems=Math.max(s.minItems,i.minItems):s.minItems=i.minItems),-1!==i.maxItems&&(-1!==s.maxItems?s.maxItems=Math.min(s.maxItems,i.maxItems):s.maxItems=i.maxItems)}),s)};return t(this)};var E=function(){this.eventhandlers=[],this.root=null,this.formDesc=null};E.prototype.initialize=function(e){function t(e){if(e&&e.properties){var n=Array.isArray(e.required)?e.required:[];for(var i in e.properties){var a=e.properties[i];if(!0===a.required)n.indexOf(i)<0&&n.push(i);else if(void 0!==a.required&&!1!==a.required&&!Array.isArray(a.required))throw new Error("field "+i+"'s required property should be either boolean or array of strings");if("object"===a.type?s.indexOf(a)<0&&(s.push(a),t(a)):delete a.required,"array"===a.type&&a.items){if(Array.isArray(a.items))throw new Error("the items property of array property "+i+" in the schema definition must be an object");"object"===a.items.type&&s.indexOf(a.items)<0&&(s.push(a.items),t(a.items))}}n.length>0?e.required=n:delete e.required}}function n(e,t){Object.keys(e).forEach(function(i,a,l){var s=e[i];if(null!==s&&"object"==typeof s)if(s.$ref)if("#/definitions/"===s.$ref.slice(0,14)){var r=s.$ref.replace(/^#\/definitions\//,"");e[i]=t[r]}else console.log("Unresolved $ref: "+s.$ref);else o.indexOf(s)<0&&(n(s,t),o.push(s))})}e=e||{},this.formDesc=i.clone(e),u.defaultClasses=l(this.formDesc.isBootstrap2||u.isBootstrap2),this.defaultClasses=i.clone(u.defaultClasses),this.formDesc.defaultClasses&&i.extend(this.defaultClasses,this.formDesc.defaultClasses),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+i.uniqueId(),this.formDesc.schema&&!this.formDesc.schema.properties&&(this.formDesc.schema={properties:this.formDesc.schema});var s=[];if(t(this.formDesc.schema),this.formDesc.schema.definitions)for(var r in this.formDesc.schema.definitions)t(this.formDesc.schema.definitions[r]);this.formDesc._originalSchema=this.formDesc.schema,this.formDesc.schema=a.parse(a.stringify(this.formDesc.schema));var o=[];this.formDesc.schema.definitions&&n(this.formDesc.schema,this.formDesc.schema.definitions),this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=i.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new k,this.root.ownerTree=this,this.root.view=u.elementTypes.root,this.buildTree(),this.computeInitialValues()},E.prototype.buildTree=function(){i.each(this.formDesc.form,function(e){"*"===e?i.each(this.formDesc.schema.properties,function(e,t){this.formDesc.nonDefaultFormItems&&this.formDesc.nonDefaultFormItems.indexOf(t)>=0||this.root.appendChild(this.buildFromLayout({key:t}))},this):(i.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},E.prototype.buildFromLayout=function(e,t){function n(e,t){var i=e.split("."),a=i.pop();if("[]"==a.slice(-2))return!1;var l=i.join("."),s=!1;if(l){var r=b(t.properties,l);(s=r.required&&r.required.indexOf(a)>=0)&&(s="[]"==l.slice(-2)||n(l,t))}else s=t.required&&t.required.indexOf(a)>=0;return s}function a(e,t){e.options?Array.isArray(e.options)?e.options=e.options.map(function(e){return c(e,"value")?e:{value:e,title:e}}):"object"==typeof e.options&&(e.options=Object.keys(e.options).map(function(t){return{value:t,title:e.options[t]}})):e.titleMap?e.options=i.map(t,function(t){var n=t.toString();return{value:t,title:c(e.titleMap,n)?e.titleMap[n]:n}}):e.options=t.map(function(e){return{value:e,title:e.toString()}})}var l=null,s=new k,r=null;if(e.key&&this.formDesc.customFormItems){var o=this.formDesc.customFormItems[e.key];void 0!==o&&(o.key=e.key,e=o)}if((e=i.clone(e)).items&&(i.isArray(e.items)?e.items=i.map(e.items,i.clone):e.items=[i.clone(e.items)]),e.key){if(!(l=b(this.formDesc.schema.properties,e.key)))throw new Error('The JSONForm object references the schema key "'+e.key+'" but that key does not exist in the JSON schema');if(this.formDesc.onElementSchema&&this.formDesc.onElementSchema(e,l),e.name=e.name||e.key,e.title=e.title||l.title,e.description=e.description||l.description,e.readOnly=e.readOnly||l.readOnly||e.readonly||l.readonly,e.required=!0===e.required||!0===l.required||n(e.key,this.formDesc.schema),e.id||(e.id=f(this.formDesc.prefix)+"-elt-"+e.key),e.allowEmpty&&(l._jsonform_allowEmpty=!0),e.type||("string"===l.type&&"color"===l.format?e.type="color":"number"!==l.type&&"integer"!==l.type||l.enum?"string"!==l.type&&"any"!==l.type||l.enum?"boolean"===l.type?e.type="checkbox":"object"===l.type?l.properties?e.type="fieldset":e.type="textarea":i.isUndefined(l.enum)?e.type=l.type:e.type="select":e.type="text":e.type="number"),e.options?a(e):(l.enum||"boolean"===l.type)&&((m=l.enum)?e.optionsAsEnumOrder=!0:m="select"===e.type?["",!0,!1]:[!0,!1],a(e,m)),("checkboxes"===e.type||"checkboxbuttons"===e.type)&&l.items){var d=Array.isArray(l.items)?l.items[0]:l.items;if(e.options)a(e),d._jsonform_checkboxes_as_array="value";else{var m=d.enum;m&&(a(e,m),e.optionsAsEnumOrder=!0,d._jsonform_checkboxes_as_array="checkboxes"===e.type||"value")}}"tagsinput"===e.getValue&&(l._jsonform_get_value_by_tagsinput="tagsinput"),"object"===l.type&&i.each(l.properties,function(t,n){var i=e.key+"."+n;this.formDesc.nonDefaultFormItems&&this.formDesc.nonDefaultFormItems.indexOf(i)>=0||s.appendChild(this.buildFromLayout({key:i}))},this)}if(e.type||(e.type="text"),!(r=u.elementTypes[e.type]))throw new Error('The JSONForm contains an element whose type is unknown: "'+e.type+'"');if(l){if(!r.inputfield&&!r.array&&"selectfieldset"!==e.type&&"object"!==l.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+e.key+'") and that should not based on its type ("'+e.type+'")')}else if(r.inputfield&&"selectfieldset"!==e.type)throw new Error('The JSONForm defines an element of type "'+e.type+'" but no "key" property to link the input field to the JSON schema');if(e.iddot=f(e.id||""),s.formElement=e,s.schemaElement=l,s.view=r,s.ownerTree=this,e.handlers||(e.handlers={}),s.view.array);else if(e.items)i.each(e.items,function(e){i.isString(e)&&(e={key:e}),s.appendChild(this.buildFromLayout(e))},this);else if(e.otherField){var h=e.otherField;i.isString(h)?h=e.otherField={key:h,notitle:!0}:void 0===h.notitle&&(h.notitle=!0),void 0===h.inline&&(h.inline=e.inline),s.appendChild(this.buildFromLayout(h))}return s},E.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},E.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&n(e).addClass("jsonform-hasrequired"),n(e).addClass("jsonform"))},E.prototype.forEachElement=function(e){var t=function(n){for(var i=0;i<n.children.length;i++)e(n.children[i]),t(n.children[i])};t(this.root)},E.prototype.validate=function(e){var i=u.getFormValue(this.domRoot),a=!1,l=this.formDesc;if(!1!==l.validate){var s=!1;if("object"!=typeof l.validate?t.ZSchema?(s=new t.ZSchema)._vendor="z-schema":t.jjv?(s=t.jjv())._vendor="jjv":t.JSONFormValidator&&((s=t.JSONFormValidator.createEnvironment("json-schema-draft-03"))._vendor="jsv"):s=l.validate,s)if(n(this.domRoot).jsonFormErrors(!1,l),"jjv"==s._vendor)(r=s.validate(this.formDesc._originalSchema,i))&&(a=[r]);else{var r=s.validate(i,this.formDesc._originalSchema);"z-schema"==s._vendor?(a=s.getLastErrors(),r=r?null:{errors:a}):r&&r.errors&&r.errors.length&&(a||(a=[]),a=a.concat(r.errors))}}return a&&!e&&(l.displayErrors?l.displayErrors(a,this.domRoot):n(this.domRoot).jsonFormErrors(a,l)),{errors:a,values:i}},E.prototype.submit=function(e){var t=function(){return e&&(e.preventDefault(),e.stopPropagation()),!1},n=u.getFormValue(this.domRoot),i=this.formDesc,a=!1;if(this.forEachElement(function(t){a||t.view.onSubmit&&(a=!t.view.onSubmit(e,t))}),a)return t();var l=this.validate();return i.onSubmit&&!i.onSubmit(l.errors,n)?t():l.errors?t():!(!i.onSubmitValid||i.onSubmitValid(n))&&t()},E.prototype.hasRequiredField=function(){return n(this.domRoot).find(".jsonform-required").length>0},u.getFormValue=function(e){var t=n(e).data("jsonform-tree");return t?t.root.getFormValues():null},n.fn.jsonFormErrors=function(e,t){var i=n(this).data("jsonform-tree");if(n("."+i.defaultClasses.groupMarkClassPrefix+"error",this).removeClass(i.defaultClasses.groupMarkClassPrefix+"error"),n("."+i.defaultClasses.groupMarkClassPrefix+"warning",this).removeClass(i.defaultClasses.groupMarkClassPrefix+"warning"),n(".jsonform-errortext",this).hide(),e){for(var a=[],l=0;l<e.length;l++){var s=e[l].uri||e[l].path;if(["OBJECT_DEPENDENCY_KEY","OBJECT_MISSING_REQUIRED_PROPERTY"].indexOf(e[l].code)>=0&&("/"!=s.slice(-1)&&(s+="/"),s+=e[l].params[0]),s){s=s.replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]");var r=".jsonform-error-"+f(s.replace(/\./g,"---"));a.push(r);var o=e[l].type||"error",d=n(r,this);"ARRAY_LENGTH_SHORT"==e[l].code&&["checkboxes","checkboxbuttons"].indexOf(d.data("jsonform-type"))>=0&&(e[l].message="Please select at least "+e[l].params[1]+(e[l].params[1]>1?" options":" option")+" above."),d.addClass(i.defaultClasses.groupMarkClassPrefix+o),d.find("> div > .jsonform-errortext, > .jsonform-errortext").text(e[l].message).show()}}a=a.join(",");var m=n(a,this),c=m.parents(".tab-pane"),u=n();c.each(function(){var e=n(this);u=u.add(e.closest(".tabbable").find("> .nav > li").eq(e.index()).addClass(i.defaultClasses.groupMarkClassPrefix+"error"))});var h=m.filter(":visible").get(0);!h&&u.length>0&&(h=u.get(0)),h&&h.scrollIntoView&&h.scrollIntoView(!0,{behavior:"smooth"})}},n.fn.jsonForm=function(e,t){if("values"===e)return u.getFormValue(this);if("submit"===e)return(s=this.data("jsonform-tree"))?s.submit():null;if("validate"===e)return(s=this.data("jsonform-tree"))?s.validate(t):null;var l=this;e=i.defaults({},e,{submitEvent:"submit"});var s=new E;return s.initialize(e),s.render(l.get(0)),e.transloadit&&l.append('<input type="hidden" name="params" value=\''+h(a.stringify(e.transloadit.params))+"'>"),l.data("jsonform-tree",s),e.submitEvent&&(l.unbind(e.submitEvent+".jsonform"),l.bind(e.submitEvent+".jsonform",function(e){s.submit(e)})),p(l),n(".expandable > div, .expandable > fieldset",l).hide(),l.on("click",".expandable > legend",function(){var e=n(this).parent();e.toggleClass("expanded"),n("> div",e).slideToggle(100)}),s},n.fn.jsonFormValue=function(){return u.getFormValue(this)},t.JSONForm||(t.JSONForm=u)}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof jQuery?jQuery:{fn:{}},"undefined"!=typeof _?_:null,JSON);